include ../partials/component.pug
div.row
    article.col-md-12#cardList
        div.jarviswidget.jarviswidget-color-orange(data-widget-editbutton="false" , data-widget-deletebutton='false')
            header
                span.widget-icon
                    i.fa.fa-users
                h2 DAFTAR PELANGGAN
            div
                div(class = "jarviswidget-editbox")
                div(class = "widget-body no-padding")
                    div.col-lg-12(style="padding:10px;background-color:#eee;")
                        div(class = 'col-lg-2 col-sm-2 col-xs-2')
                            input(class = 'form-control datepicker' value = tgl_awal data-dateformat = "yy-mm-dd" placeholder = 'Tanggal Tagihan' id = 'tgl_tagihan')
                        div(class = 'col-lg-4 col-sm-4 col-xs-4')
                            button#searchRekapProd(class = 'btn btn-default pull-left' data-original-title = 'Pencarian' data-placement="bottom" rel="tooltip")
                                i(class="fa fa-fw fa-search")
                            button(class = 'btn btn-default pull-left' data-original-title = 'Tambah Pelanggan' data-placement="bottom" rel="tooltip" style = 'margin-left : 5px;' onClick = 'return addData();')
                                i(class="fa fa-fw fa-plus")
                            button(class = 'btn btn-default pull-left' data-original-title = 'Reset & Refresh' data-placement="bottom" rel="tooltip" style = 'margin-left : 5px;' onclick = "return refreshData();")
                                i(class="fa fa-fw fa-refresh")
                            button#printTable(class = 'btn btn-default pull-left' data-original-title = 'Cetak' data-placement="bottom" rel="tooltip" style = 'margin-left : 10px;')
                                i(class="fa fa-fw fa-print")
                    table(id = "customerTable" class = "table table-striped table-bordered table-hover" width = "100%")
                        thead
                            tr
                                th Action
                                th Pelanggan
                                th Alamat
                                th Tagihan
                                th(data-hide = 'phone,tablet') Tgl Tagihan
    
    article.col-md-5(style="display: none;" data-action="edit")#formEditable
    article.col-md-5(style="display: none;" data-action="edit")#formEditTag
        div.jarviswidget.jarviswidget-color-orange(data-widget-editbutton="false" , data-widget-deletebutton='false')
            header(role = 'heading')
                div.jarviswidget-ctrls
                    a(class = 'button-icon jarviswidget-toggle-btn' href = 'javascript:void(0);' rel = 'tooltip' data-placement = 'bottom' data-original-title = 'Tutup' onclick="return closeForm('#formEditTag');")#btnCloseForm
                        i.fa.fa-times
                span.widget-icon
                    i.fa.fa-pencil
                h2 Update Tagihan
            div
                div.jarviswidget-editbox
                div(class='widget-body no-padding')
                    form.form-horizontal
                        div.form-group
                            input#userId(type="hidden", name="_id").form-control
                        div.form-group
                            label(for = "inputNewTag").control-label.col-lg-3 Tagihan
                            div.col-lg-7
                                input.form-control#newTag(type="text")
                        div.form-group
                            div.col-lg-7.col-lg-offset-3
                                button#submitReset(type="submit" class="btn btn-sm btn-primary")
                                    i.icon-save
                                    span  Simpan
                                button#batal(type="button" onclick="return closeForm('#formEditTag');" style="margin-left : 10px;" class="btn btn-outline-danger btn-sm")
                                    span Batal

    //- IFRAME CONTENT PRIVIEW
    iframe(id = "ifmcontentstoprint" style="height: 0px; width: 0px; position: absolute;")
script.
    pageSetUp();
    var tableCustomer

    function closeForm(selector) {
        $(selector).slideUp(200, function() {
        $('#reset').click()
        $("#cardList").removeClass("col-md-7").addClass("col-md-12");
            refreshData();
        });
    }

    function refreshData () {
        tableCustomer.ajax.reload(null, false);
    }

    function addData () {
		$("#formEditTag").fadeOut();
		$("#cardList").removeClass("col-md-12").addClass("col-md-7");
		$("#formEditable").attr("data-action", "add").fadeIn(200);
		$("#formEditable").load('/customer/createForm/add');
		refreshData();
	}

    $(function () {
        $('.datepicker').datepicker({
            defaultDate : new Date(),
            dateFormat : 'yy-mm-dd'
        });

        tableCustomer = dataTable('#customerTable',{
            searching : false,
            url : '/customer/dataTable?tgl_tagihan=all',
            columns : [
                {
                    "data" : "action",
                },{
                    "data" : "customer"
                },{
                    "data" : "alamat"
                },{
                    "data" : "tagihan"
                },{
                    "data" : "created_at"
                }
            ],
            columnDefs: [
                { width: "10%", targets: 0 },
                { width: "20%", targets: 1 },
                { width: "40%", targets: 2 },
                { width: "20%", targets: 3 },
                { width: "25%", targets: 4 },
            ],
        });
    })