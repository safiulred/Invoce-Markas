include ../../partials/component.pug
div.row
	div#formEditable(style="display: none" data-action="edit")
	//- article.col-md-12(style="display: none" data-action="edit")#formEditable

	article.col-md-12#cardList
		div.jarviswidget.jarviswidget-color-orange(data-widget-editbutton="false" , data-widget-deletebutton='false')
			header
				span.widget-icon
					i.fa.fa-user
				h2 TRANASKSI ORDER JASA & BARANG
			div
				div(class = "jarviswidget-editbox")
				div(class = "widget-body no-padding")
					div.col-lg-12(style="padding:10px;background-color:#eee;")
						div(class = 'col-lg-2 col-sm-2 col-xs-2')
							input(class = 'form-control datepicker' value = tgl_awal data-dateformat = "yy-mm-dd" placeholder = 'Tanggal Awal' id = 'tgl_awal')
						div(class = 'col-lg-2 col-sm-2 col-xs-2')
							input(class = 'form-control datepicker' value = tgl_akhir data-dateformat = "yy-mm-dd" placeholder = 'Tanggal Awal' id = 'tgl_akhir')
						div.col-lg-2
							select.form-control#statusJasaBarang
								option(value = 'all') Pilih Status
								option(value = '0') Pending
								option(value = '1') Approved
								option(value = '2') Process
								option(value = '4') Cancel
								option(value = '3') Completed
						div.col-lg-2
							select.form-control#customerJasaBarang
								option(value = 'all') Pilih Pelanggan
								each c in customers
									option(value=c._id) #{c.nama}
						div(class = 'col-lg-4 col-sm-4 col-xs-4')
							button#searchOrder(class = 'btn btn-default pull-left' data-original-title = 'Pencarian' data-placement="bottom" rel="tooltip")
								i(class="fa fa-fw fa-search")
							button(class = 'btn btn-primary pull-right' data-original-title = 'Tambah Order' data-placement="bottom" rel="tooltip" style = 'margin-left : 5px;' onclick = "return addData();") TAMBAH ORDER
							button(class = 'btn btn-default pull-left' data-original-title = 'Reset & Refresh' data-placement="bottom" rel="tooltip" style = 'margin-left : 5px;' onclick = "return refreshData();")
								i(class="fa fa-fw fa-refresh")
					table(id = "OrderTable" class = "table table-striped table-bordered table-hover" width = "100%")
						thead
							tr
								th Action
								th(width = '18%' ata-hide = 'phone,tablet') Transaksi
								th(width = '14%' ata-hide = 'phone,tablet') Tanggal Pesanan
								th Pelanggan
								th User
								th Status

script.
	pageSetUp();
	var tableOrder;

	function closeForm(element) {
		$("#formEditable").slideUp(200, function() {
			$('#reset').click()
			refreshData();
		});
	}

	function addData () {
		$("#formEditable").attr("data-action", "add").slideDown(200, function (){
			$("#formEditable").load('/transaksi/order/createForm/add');
			refreshData();
		});
	}

	function refreshData () {
		tableOrder.ajax.reload(null, false);
	}

	$(function (){
		$('.datepicker').datepicker({
			defaultDate : new Date(),
			dateFormat : 'yy-mm-dd'
		});

		$("#selectStatus").change(function (e){
			e.preventDefault();
			var val = $(this).val();
		});

		tableOrder = dataTable('#OrderTable',{
			searching : false,
			url : `/transaksi/order/dataTable?customer=all&status=all&tgl_awal=all&tgl_akhir=all`,
			columns : [
				{
					"data" : "action",
				},{
					"data" : "trx"
				},{
					"data" : "tanggal"
				},{
					"data" : "customer"
				},{
					"data" : "user"
				},{
					"data" : "status"
				}
			],
			columnDefs: [
				{ width: "10%", targets: 0 },
			],
		});

		$("#searchOrder").click(function (e){
			e.preventDefault();
			var status = $('#statusJasaBarang').val();
			var customer = $('#customerJasaBarang').val();
			var tgl_awal = $('#tgl_awal').val();
			var tgl_akhir = $('#tgl_akhir').val();

			tableOrder = dataTable('#OrderTable',{
				searching : false,
				url : `/transaksi/order/dataTable?customer=${customer}&status=${status}&tgl_awal=${tgl_awal}&tgl_akhir=${tgl_akhir}`,
				columns : [
					{
						"data" : "action",
					},{
						"data" : "trx"
					},{
						"data" : "tanggal"
					},{
						"data" : "customer"
					},{
						"data" : "user"
					},{
						"data" : "status"
					}
				],
				columnDefs: [
					{ width: "10%", targets: 0 },
				],
			});
		});
	});